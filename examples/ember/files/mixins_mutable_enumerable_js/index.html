<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>mixins/mutable_enumerable.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script type="text/javascript" src="../../assets/scripts/vendor/jquery-1.8.3.min.js"></script>

  <script type="text/javascript" src="../../assets/scripts/vendor/lodash.min.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/raphael-min.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/morris.min.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/bootstrap-tooltip.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/bootstrap-popover.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/codemirror/codemirror.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/codemirror/util/searchcursor.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/codemirror/javascript.js"></script>

  <script type="text/javascript" src="report.js"></script>

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap-3.0.0-wip.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="brand" href="http://github.com/jsoverson/plato">Plato on Github</a>
    <ul class="nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>mixins/mutable_enumerable.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="span4">
      <h2 class="header">Complexity</h2>
      <p class="stat">1</p>
    </div>
    <div class="span4">
      <h2 class="header">Maintainability</h2>
      <p class="stat">139.73</p>
    </div>
    <div class="span4">
      <h2 class="header">Estimated # Bugs</h2>
      <p class="stat">0.16</p>
    </div>
  </div>
  <div class="row">
    <div class="span4">
      <h2 class="header">Difficulty</h2>
      <p class="stat">11.05</p>
    </div>
    <div class="span4">
      <h2 class="header">Volume</h2>
      <p class="stat">476.08</p>
    </div>
    <div class="span4">
      <h2 class="header">SLOC/LSLOC</h2>
      <p class="stat">114 / 17</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="span6">
      <h3 class="chart-header">By Complexity</h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="span6">
      <h3 class="chart-header">By SLOC</h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="span12">require('ember-runtime/mixins/enumerable');

/**
@module ember
@submodule ember-runtime
*/

var forEach = Ember.EnumerableUtils.forEach;

/**
  This mixin defines the API for modifying generic enumerables. These methods
  can be applied to an object regardless of whether it is ordered or
  unordered.

  Note that an Enumerable can change even if it does not implement this mixin.
  For example, a MappedEnumerable cannot be directly modified but if its
  underlying enumerable changes, it will change also.

  ## Adding Objects

  To add an object to an enumerable, use the `addObject()` method. This
  method will only add the object to the enumerable if the object is not
  already present and the object if of a type supported by the enumerable.

  ```javascript
  set.addObject(contact);
  ```

  ## Removing Objects

  To remove an object form an enumerable, use the `removeObject()` method. This
  will only remove the object if it is already in the enumerable, otherwise
  this method has no effect.

  ```javascript
  set.removeObject(contact);
  ```

  ## Implementing In Your Own Code

  If you are implementing an object and want to support this API, just include
  this mixin in your class and implement the required methods. In your unit
  tests, be sure to apply the Ember.MutableEnumerableTests to your object.

  @class MutableEnumerable
  @namespace Ember
  @extends Ember.Mixin
  @uses Ember.Enumerable
*/
Ember.MutableEnumerable = Ember.Mixin.create(Ember.Enumerable,
  /** @scope Ember.MutableEnumerable.prototype */ {

  /**
    __Required.__ You must implement this method to apply this mixin.

    Attempts to add the passed object to the receiver if the object is not
    already present in the collection. If the object is present, this method
    has no effect.

    If the passed object is of a type not supported by the receiver
    then this method should raise an exception.

    @method addObject
    @param {Object} object The object to add to the enumerable.
    @return {Object} the passed object
  */
  addObject: Ember.required(Function),

  /**
    Adds each object in the passed enumerable to the receiver.

    @method addObjects
    @param {Ember.Enumerable} objects the objects to add.
    @return {Object} receiver
  */
  addObjects: function(objects) {
    Ember.beginPropertyChanges(this);
    forEach(objects, function(obj) { this.addObject(obj); }, this);
    Ember.endPropertyChanges(this);
    return this;
  },

  /**
    __Required.__ You must implement this method to apply this mixin.

    Attempts to remove the passed object from the receiver collection if the
    object is in present in the collection. If the object is not present,
    this method has no effect.

    If the passed object is of a type not supported by the receiver
    then this method should raise an exception.

    @method removeObject
    @param {Object} object The object to remove from the enumerable.
    @return {Object} the passed object
  */
  removeObject: Ember.required(Function),


  /**
    Removes each objects in the passed enumerable from the receiver.

    @method removeObjects
    @param {Ember.Enumerable} objects the objects to remove
    @return {Object} receiver
  */
  removeObjects: function(objects) {
    Ember.beginPropertyChanges(this);
    forEach(objects, function(obj) { this.removeObject(obj); }, this);
    Ember.endPropertyChanges(this);
    return this;
  }

});
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-notice-template">
<div class="complexity-notice">
  Complexity : {{ complexity.cyclomatic }} <br>
  Length : {{ complexity.halstead.length }} <br>
  Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
  Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
</div>
</script>
<script>
  function focusFragment() {
    $('.plato-mark').removeClass('focus');
    var markId = window.location.hash.substr(1);
    if (markId) $('.' + markId).addClass('focus');
  }

  $(focusFragment)
  window.onhashchange = function(){
    focusFragment();
  }

  var srcEl = document.getElementById('file-source');
  var options = {
    lineNumbers : true,
    gutters     : ['plato-gutter'],
    readOnly    : 'nocursor'
  };
  var cm = CodeMirror.fromTextArea(srcEl, options);

  var byComplexity = _.map(__report.functions,function(fn,i){
    return {
      label : fn.name,
      value : fn.complexity.cyclomatic
    }
  })

  var bySloc = _.map(__report.functions,function(fn,i){
    return {
      label : fn.name,
      value : fn.complexity.sloc.physical,
      formatter: function (x) { return x + " lines"}
    }
  })

  var scrollToLine = function(i, data) {
    var origScroll = [window.pageXOffset,window.pageYOffset];
    window.location.hash = '#plato-mark-fn-' + i;
    window.scrollTo(origScroll[0],origScroll[1]);
    var line = __report.functions[i].line;
    var coords = cm.charCoords({line : line, ch : 0});
    $('body,html').animate({scrollTop : coords.top -50},250)
  };

  Morris.Donut({
    element: 'fn-by-complexity',
    data: byComplexity
  }).on('click',scrollToLine);
  Morris.Donut({
    element: 'fn-by-sloc',
    data: bySloc
  }).on('click',scrollToLine);


  __report.functions.forEach(function (fn,i) {
    var name = fn.name === '<anonymous>' ? 'function\\s*\\([^)]*\\)' : fn.name;
    var line = fn.line - 1;
    var re = new RegExp('(' + name + ')', 'g');
    var cursor = cm.getSearchCursor(re, {line : line, ch : 0});
    var match;
    _.templateSettings = {
      interpolate : /\{\{(.+?)\}\}/g
    };
    var notice = _.template($('#complexity-notice-template').text());
//    cm.addLineWidget(line, $(notice(fn))[0], {});

    while (match = cursor.findNext()) {
      if (cursor.to().line !== line) break;
      cm.markText(
        { line : line, ch : cursor.from().ch },
        { line : line, ch : cursor.to().ch },
        {
          className   : 'plato-mark plato-mark-fn-' + i,
          startStyle  : 'plato-mark-start',
          endStyle    : 'plato-mark-end'
        }
      )
    }
    var gutterIcon = $('<a class="plato-gutter-complexity" name="' + ('plato-mark-fn-'+i) + '"><i class="icon-cog"></i></a>');
    cm.setGutterMarker(line, 'plato-gutter', gutterIcon[0])
    var stillIn = false;
    var markStart = $('.plato-mark-start.plato-mark-fn-' + i);
    var markSpans = $('.plato-mark-fn-' + i);

    markSpans.add(gutterIcon)
      .on('mouseenter touchstart',function(e){
        e.preventDefault();
        e.stopPropagation();
        markSpans.addClass('active');
        stillIn = true;
        markStart.popover('show');
      })
      .on('mouseleave touchend',function(e){
        e.preventDefault();
        e.stopPropagation();
        markSpans.removeClass('active');
        stillIn = false;
        setTimeout(function(){
          if (!stillIn) markStart.popover('hide');
        },200);
      });

    markStart.popover({
      trigger : 'manual',
      content : notice(fn),
      html : true,
      title : fn.name === '<anonymous>' ? '&lt;anonymous&gt;' : 'function ' + fn.name + '',
      placement : 'top'
    })

  })

</script>
</body>
</html>
