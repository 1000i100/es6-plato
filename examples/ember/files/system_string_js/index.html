<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>system/string.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script type="text/javascript" src="../../assets/scripts/vendor/jquery-1.8.3.min.js"></script>

  <script type="text/javascript" src="../../assets/scripts/vendor/lodash.min.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/raphael-min.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/morris.min.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/bootstrap-tooltip.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/bootstrap-popover.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/codemirror/codemirror.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/codemirror/util/searchcursor.js"></script>
  <script type="text/javascript" src="../../assets/scripts/vendor/codemirror/javascript.js"></script>

  <script type="text/javascript" src="report.js"></script>

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap-3.0.0-wip.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="brand" href="http://github.com/jsoverson/plato">Plato on Github</a>
    <ul class="nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>system/string.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="span4">
      <h2 class="header">Complexity</h2>
      <p class="stat">7</p>
    </div>
    <div class="span4">
      <h2 class="header">Maintainability</h2>
      <p class="stat">139.30</p>
    </div>
    <div class="span4">
      <h2 class="header">Estimated # Bugs</h2>
      <p class="stat">0.56</p>
    </div>
  </div>
  <div class="row">
    <div class="span4">
      <h2 class="header">Difficulty</h2>
      <p class="stat">21.93</p>
    </div>
    <div class="span4">
      <h2 class="header">Volume</h2>
      <p class="stat">1673.29</p>
    </div>
    <div class="span4">
      <h2 class="header">SLOC/LSLOC</h2>
      <p class="stat">230 / 40</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="span6">
      <h3 class="chart-header">By Complexity</h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="span6">
      <h3 class="chart-header">By SLOC</h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="span12">/**
@module ember
@submodule ember-runtime
*/

var STRING_DASHERIZE_REGEXP = (/[ _]/g);
var STRING_DASHERIZE_CACHE = {};
var STRING_DECAMELIZE_REGEXP = (/([a-z])([A-Z])/g);
var STRING_CAMELIZE_REGEXP = (/(\-|_|\s)+(.)?/g);
var STRING_UNDERSCORE_REGEXP_1 = (/([a-z\d])([A-Z]+)/g);
var STRING_UNDERSCORE_REGEXP_2 = (/\-|\s+/g);

/**
  Defines the hash of localized strings for the current language. Used by
  the `Ember.String.loc()` helper. To localize, add string values to this
  hash.

  @property STRINGS
  @for Ember
  @type Hash
*/
Ember.STRINGS = {};

/**
  Defines string helper methods including string formatting and localization.
  Unless `Ember.EXTEND_PROTOTYPES.String` is `false` these methods will also be
  added to the `String.prototype` as well.

  @class String
  @namespace Ember
  @static
*/
Ember.String = {

  /**
    Apply formatting options to the string. This will look for occurrences
    of "%@" in your string and substitute them with the arguments you pass into
    this method. If you want to control the specific order of replacement,
    you can add a number after the key as well to indicate which argument
    you want to insert.

    Ordered insertions are most useful when building loc strings where values
    you need to insert may appear in different orders.

    ```javascript
    "Hello %@ %@".fmt('John', 'Doe');     // "Hello John Doe"
    "Hello %@2, %@1".fmt('John', 'Doe');  // "Hello Doe, John"
    ```

    @method fmt
    @param {Object...} [args]
    @return {String} formatted string
  */
  fmt: function(str, formats) {
    // first, replace any ORDERED replacements.
    var idx  = 0; // the current index for non-numerical replacements
    return str.replace(/%@([0-9]+)?/g, function(s, argIndex) {
      argIndex = (argIndex) ? parseInt(argIndex,0) - 1 : idx++ ;
      s = formats[argIndex];
      return ((s === null) ? '(null)' : (s === undefined) ? '' : s).toString();
    }) ;
  },

  /**
    Formats the passed string, but first looks up the string in the localized
    strings hash. This is a convenient way to localize text. See
    `Ember.String.fmt()` for more information on formatting.

    Note that it is traditional but not required to prefix localized string
    keys with an underscore or other character so you can easily identify
    localized strings.

    ```javascript
    Ember.STRINGS = {
      '_Hello World': 'Bonjour le monde',
      '_Hello %@ %@': 'Bonjour %@ %@'
    };

    Ember.String.loc("_Hello World");  // 'Bonjour le monde';
    Ember.String.loc("_Hello %@ %@", ["John", "Smith"]);  // "Bonjour John Smith";
    ```

    @method loc
    @param {String} str The string to format
    @param {Array} formats Optional array of parameters to interpolate into string.
    @return {String} formatted string
  */
  loc: function(str, formats) {
    str = Ember.STRINGS[str] || str;
    return Ember.String.fmt(str, formats) ;
  },

  /**
    Splits a string into separate units separated by spaces, eliminating any
    empty strings in the process. This is a convenience method for split that
    is mostly useful when applied to the `String.prototype`.

    ```javascript
    Ember.String.w("alpha beta gamma").forEach(function(key) {
      console.log(key);
    });

    // > alpha
    // > beta
    // > gamma
    ```

    @method w
    @param {String} str The string to split
    @return {String} split string
  */
  w: function(str) { return str.split(/\s+/); },

  /**
    Converts a camelized string into all lower case separated by underscores.

    ```javascript
    'innerHTML'.decamelize();           // 'inner_html'
    'action_name'.decamelize();        // 'action_name'
    'css-class-name'.decamelize();     // 'css-class-name'
    'my favorite items'.decamelize();  // 'my favorite items'
    ```

    @method decamelize
    @param {String} str The string to decamelize.
    @return {String} the decamelized string.
  */
  decamelize: function(str) {
    return str.replace(STRING_DECAMELIZE_REGEXP, '$1_$2').toLowerCase();
  },

  /**
    Replaces underscores or spaces with dashes.

    ```javascript
    'innerHTML'.dasherize();          // 'inner-html'
    'action_name'.dasherize();        // 'action-name'
    'css-class-name'.dasherize();     // 'css-class-name'
    'my favorite items'.dasherize();  // 'my-favorite-items'
    ```

    @method dasherize
    @param {String} str The string to dasherize.
    @return {String} the dasherized string.
  */
  dasherize: function(str) {
    var cache = STRING_DASHERIZE_CACHE,
        ret   = cache[str];

    if (ret) {
      return ret;
    } else {
      ret = Ember.String.decamelize(str).replace(STRING_DASHERIZE_REGEXP,'-');
      cache[str] = ret;
    }

    return ret;
  },

  /**
    Returns the lowerCaseCamel form of a string.

    ```javascript
    'innerHTML'.camelize();          // 'innerHTML'
    'action_name'.camelize();        // 'actionName'
    'css-class-name'.camelize();     // 'cssClassName'
    'my favorite items'.camelize();  // 'myFavoriteItems'
    ```

    @method camelize
    @param {String} str The string to camelize.
    @return {String} the camelized string.
  */
  camelize: function(str) {
    return str.replace(STRING_CAMELIZE_REGEXP, function(match, separator, chr) {
      return chr ? chr.toUpperCase() : '';
    });
  },

  /**
    Returns the UpperCamelCase form of a string.

    ```javascript
    'innerHTML'.classify();          // 'InnerHTML'
    'action_name'.classify();        // 'ActionName'
    'css-class-name'.classify();     // 'CssClassName'
    'my favorite items'.classify();  // 'MyFavoriteItems'
    ``` 

    @method classify
    @param {String} str the string to classify
    @return {String} the classified string
  */
  classify: function(str) {
    var camelized = Ember.String.camelize(str);
    return camelized.charAt(0).toUpperCase() + camelized.substr(1);
  },

  /**
    More general than decamelize. Returns the lower\_case\_and\_underscored
    form of a string.

    ```javascript
    'innerHTML'.underscore();          // 'inner_html'
    'action_name'.underscore();        // 'action_name'
    'css-class-name'.underscore();     // 'css_class_name'
    'my favorite items'.underscore();  // 'my_favorite_items'
    ```

    @method underscore
    @param {String} str The string to underscore.
    @return {String} the underscored string.
  */
  underscore: function(str) {
    return str.replace(STRING_UNDERSCORE_REGEXP_1, '$1_$2').
      replace(STRING_UNDERSCORE_REGEXP_2, '_').toLowerCase();
  },

  /**
    Returns the Capitalized form of a string

       'innerHTML'.capitalize()         => 'InnerHTML'
       'action_name'.capitalize()       => 'Action_name'
       'css-class-name'.capitalize()    => 'Css-class-name'
       'my favorite items'.capitalize() => 'My favorite items'

    @method capitalize
    @param {String} str
    @return {String}
  */
  capitalize: function(str) {
    return str.charAt(0).toUpperCase() + str.substr(1);
  }

};
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-notice-template">
<div class="complexity-notice">
  Complexity : {{ complexity.cyclomatic }} <br>
  Length : {{ complexity.halstead.length }} <br>
  Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
  Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
</div>
</script>
<script>
  function focusFragment() {
    $('.plato-mark').removeClass('focus');
    var markId = window.location.hash.substr(1);
    if (markId) $('.' + markId).addClass('focus');
  }

  $(focusFragment)
  window.onhashchange = function(){
    focusFragment();
  }

  var srcEl = document.getElementById('file-source');
  var options = {
    lineNumbers : true,
    gutters     : ['plato-gutter'],
    readOnly    : 'nocursor'
  };
  var cm = CodeMirror.fromTextArea(srcEl, options);

  var byComplexity = _.map(__report.functions,function(fn,i){
    return {
      label : fn.name,
      value : fn.complexity.cyclomatic
    }
  })

  var bySloc = _.map(__report.functions,function(fn,i){
    return {
      label : fn.name,
      value : fn.complexity.sloc.physical,
      formatter: function (x) { return x + " lines"}
    }
  })

  var scrollToLine = function(i, data) {
    var origScroll = [window.pageXOffset,window.pageYOffset];
    window.location.hash = '#plato-mark-fn-' + i;
    window.scrollTo(origScroll[0],origScroll[1]);
    var line = __report.functions[i].line;
    var coords = cm.charCoords({line : line, ch : 0});
    $('body,html').animate({scrollTop : coords.top -50},250)
  };

  Morris.Donut({
    element: 'fn-by-complexity',
    data: byComplexity
  }).on('click',scrollToLine);
  Morris.Donut({
    element: 'fn-by-sloc',
    data: bySloc
  }).on('click',scrollToLine);


  __report.functions.forEach(function (fn,i) {
    var name = fn.name === '<anonymous>' ? 'function\\s*\\([^)]*\\)' : fn.name;
    var line = fn.line - 1;
    var re = new RegExp('(' + name + ')', 'g');
    var cursor = cm.getSearchCursor(re, {line : line, ch : 0});
    var match;
    _.templateSettings = {
      interpolate : /\{\{(.+?)\}\}/g
    };
    var notice = _.template($('#complexity-notice-template').text());
//    cm.addLineWidget(line, $(notice(fn))[0], {});

    while (match = cursor.findNext()) {
      if (cursor.to().line !== line) break;
      cm.markText(
        { line : line, ch : cursor.from().ch },
        { line : line, ch : cursor.to().ch },
        {
          className   : 'plato-mark plato-mark-fn-' + i,
          startStyle  : 'plato-mark-start',
          endStyle    : 'plato-mark-end'
        }
      )
    }
    var gutterIcon = $('<a class="plato-gutter-complexity" name="' + ('plato-mark-fn-'+i) + '"><i class="icon-cog"></i></a>');
    cm.setGutterMarker(line, 'plato-gutter', gutterIcon[0])
    var stillIn = false;
    var markStart = $('.plato-mark-start.plato-mark-fn-' + i);
    var markSpans = $('.plato-mark-fn-' + i);

    markSpans.add(gutterIcon)
      .on('mouseenter touchstart',function(e){
        e.preventDefault();
        e.stopPropagation();
        markSpans.addClass('active');
        stillIn = true;
        markStart.popover('show');
      })
      .on('mouseleave touchend',function(e){
        e.preventDefault();
        e.stopPropagation();
        markSpans.removeClass('active');
        stillIn = false;
        setTimeout(function(){
          if (!stillIn) markStart.popover('hide');
        },200);
      });

    markStart.popover({
      trigger : 'manual',
      content : notice(fn),
      html : true,
      title : fn.name === '<anonymous>' ? '&lt;anonymous&gt;' : 'function ' + fn.name + '',
      placement : 'top'
    })

  })

</script>
</body>
</html>
